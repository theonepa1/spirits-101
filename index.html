<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deccan Spirits Cost Analysis Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            background-color: #f8f8f8;
        }
        .container {
            display: flex;
            width: 100%;
        }
        .panel {
            padding: 15px;
            overflow-y: auto;
        }
        .left-panel {
            width: 70%;
            background-color: #ffffff;
            border-right: 2px solid #ccc;
        }
        .right-panel {
            width: 30%;
            background-color: #f4f4f4;
        }
        h2 {
            margin: 10px 0 15px;
            color: #333;
        }
        h3 {
            margin: 10px 0;
            font-size: 14px;
            font-weight: bold;
        }
        .compact-row {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 10px;
        }
        .subsection-container {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        .subsection {
            flex: 1;
            background-color: #f9f9f9;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }
        input, select {
            width: 100%;
            margin-bottom: 8px;
            padding: 8px;
            font-size: 13px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        input[type="range"] {
            width: 85%;
        }
        .output-section {
            background-color: #fff;
            padding-left: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .output-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .bold-value {
            font-weight: bold;
            color: #000;
        }

        p {
            margin: 8px 0px 8px 0px;
        }

        .copy-link-button {
            background-color: blue; /* Set the button background to blue */
            color: white; /* Set the text color to white for better contrast */
            border: none; /* Remove the border */
            padding: 10px 15px; /* Add some padding for a better click area */
            border-radius: 5px; /* Add rounded corners */
            font-size: 14px; /* Set a readable font size */
            cursor: pointer; /* Change the cursor to a pointer on hover */
        }

        .copy-link-button:hover {
            background-color: darkblue; /* Slightly darker blue on hover */
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Left Panel: Inputs -->
        <div class="panel left-panel">
            <!-- Product Details and Cost Inputs Side by Side -->
            <div class="subsection-container">
                <div class="subsection">
                    <h3>Product Details</h3>
                    <label for="type">Type of Spirit:</label>
                    <select id="type">
                        <option value="whiskey">Whiskey</option>
                        <option value="vodka">Vodka</option>
                        <option value="gin">Gin</option>
                        <option value="rum">Rum</option>
                    </select>
                    <label for="cases">Total Number of Cases:</label>
                    <input type="number" id="cases" min="500" max="10000" value="500">
                </div>

                <div class="subsection">
                    <h3>Cost Inputs</h3>
                    <label for="cogs">COGS: 
                        <span id="cogs-slider-value" class="bold-value">$50</span>
                    </label>
                    <input type="range" id="cogs" min="30" max="70" value="50">
                    
                    <label for="shipping">Shipping: 
                        <span id="shipping-slider-value" class="bold-value">$7</span>
                    </label>
                    <input type="range" id="shipping" min="5" max="15" value="7">
                    
                    <label for="warehousing">Warehousing: 
                        <span id="warehousing-slider-value" class="bold-value">$1</span>
                    </label>
                    <input type="range" id="warehousing" min="0.5" max="3" value="1">
                    
                    <label for="transportation">Transportation: 
                        <span id="transportation-slider-value" class="bold-value">$1.5</span>
                    </label>
                    <input type="range" id="transportation" min="1" max="5" value="1.5">
                    
                    <label for="misc">Miscellaneous Costs:</label>
                    <input type="number" id="misc" value="5000">
                </div>
            </div>

            <div class="subsection-container">
                <!-- Distributor Costs -->
                <div class="subsection">
                    <h3>Distributor Costs</h3>
                    <label for="state-tax">State Tax (per liter):</label>
                    <select id="state-tax">
                        <option value="5.73">Alabama - $5.73</option>
                        <option value="3.38">Alaska - $3.38</option>
                        <option value="0.79">Arizona - $0.79</option>
                        <option value="2.12">Arkansas - $2.12</option>
                        <option value="0.87">California - $0.87</option>
                        <option value="0.60">Colorado - $0.60</option>
                        <option value="1.57">Connecticut - $1.57</option>
                        <option value="1.19">Delaware - $1.19</option>
                        <option value="1.72">Florida - $1.72</option>
                        <option value="1.00" selected>Georgia - $1.00</option>
                        <option value="1.58">Hawaii - $1.58</option>
                        <option value="3.21">Idaho - $3.21</option>
                        <option value="2.26">Illinois - $2.26</option>
                        <option value="0.71">Indiana - $0.71</option>
                        <option value="3.73">Iowa - $3.73</option>
                        <option value="0.66">Kansas - $0.66</option>
                        <option value="2.44">Kentucky - $2.44</option>
                        <option value="0.80">Louisiana - $0.80</option>
                        <option value="3.16">Maine - $3.16</option>
                        <option value="1.44">Maryland - $1.44</option>
                        <option value="1.07">Massachusetts - $1.07</option>
                        <option value="3.59">Michigan - $3.59</option>
                        <option value="2.30">Minnesota - $2.30</option>
                        <option value="2.25">Mississippi - $2.25</option>
                        <option value="0.53">Missouri - $0.53</option>
                        <option value="2.79">Montana - $2.79</option>
                        <option value="0.99">Nebraska - $0.99</option>
                        <option value="0.95">Nevada - $0.95</option>
                        <option value="0.00">New Hampshire - $0.00</option>
                        <option value="1.45">New Jersey - $1.45</option>
                        <option value="1.60">New Mexico - $1.60</option>
                        <option value="1.70">New York - $1.70</option>
                        <option value="4.33">North Carolina - $4.33</option>
                        <option value="1.24">North Dakota - $1.24</option>
                        <option value="3.01">Ohio - $3.01</option>
                        <option value="1.47">Oklahoma - $1.47</option>
                        <option value="6.04">Oregon - $6.04</option>
                        <option value="1.96">Pennsylvania - $1.96</option>
                        <option value="1.43">Rhode Island - $1.43</option>
                        <option value="1.43">South Carolina - $1.43</option>
                        <option value="1.29">South Dakota - $1.29</option>
                        <option value="1.18">Tennessee - $1.18</option>
                        <option value="0.63">Texas - $0.63</option>
                        <option value="4.21">Utah - $4.21</option>
                        <option value="2.22">Vermont - $2.22</option>
                        <option value="5.83">Virginia - $5.83</option>
                        <option value="9.66">Washington - $9.66</option>
                        <option value="2.20">West Virginia - $2.20</option>
                        <option value="0.86">Wisconsin - $0.86</option>
                        <option value="0.00">Wyoming - $0.00</option>
                        <!-- Add other states as needed -->
                    </select>

                    <label for="inland-transportation">Inland Transportation: 
                        <span id="inland-transportation-slider-value" class="bold-value">$3.50</span>
                    </label>
                    <input type="range" id="inland-transportation" min="1.5" max="8" value="3.5">

                    <label for="distributor-warehousing">Warehousing Cost: 
                        <span id="distributor-warehousing-slider-value" class="bold-value">$1.50</span>
                    </label>
                    <input type="range" id="distributor-warehousing" min="0.5" max="3.5" value="1.5">
                </div>

                <!-- Profit Margins -->
                <div class="subsection">
                    <h3>Profit Margins</h3>
                    <label for="importer-margin">Importer Margin: 
                        <span id="importer-margin-slider-value" class="bold-value">20%</span>
                    </label>
                    <input type="range" id="importer-margin" min="5" max="50" value="20">

                    <label for="distributor-margin">Distributor Margin: 
                        <span id="distributor-margin-slider-value" class="bold-value">25%</span>
                    </label>
                    <input type="range" id="distributor-margin" min="5" max="50" value="25">

                    <label for="retailer-margin">Retailer Margin: 
                        <span id="retailer-margin-slider-value" class="bold-value">30%</span>
                    </label>
                    <input type="range" id="retailer-margin" min="10" max="50" value="30">
                </div>
            </div>
        </div>

        <!-- Right Panel: Outputs -->
        <div class="panel right-panel">

            <!-- Cost per Case Section -->
            <div class="output-section">
                <p class="output-title">Cost per Case</p>
                <p>Federal Taxes: $<span id="excise-tax">0</span></p>
                <p>CBP Duty: $<span id="cbp-duty">0</span></p>
                <p>Total Cost: $<span id="total-cost">0</span></p>
            </div>

            <!-- Price per Case Section -->
            <div class="output-section">
                <p class="output-title">Price per Case</p>
                <p><b>Importer Selling Price: $<span id="importer-price" class="bold-value">0</span></b></p>
                <p>Distributor Costs: $<span id="distributor-costs">0</span></p>
                <p>Distributor Selling Price: $<span id="distributor-price" class="bold-value">0</span></p>
                <p>Retailer Shelf Price: $<span id="retail-price" class="bold-value">0</span></p>
            </div>

            <!-- Price per Bottle Section -->
            <div class="output-section">
                <p class="output-title">Price per Bottle</p>
                <p>Importer Selling Price: $<span id="importer-price-bottle">0</span></p>
                <p>Distributor Selling Price: $<span id="distributor-price-bottle">0</span></p>
                <p><b>Retailer Shelf Price: $<span id="retail-price-bottle" class="bold-value">0</span></b></p>
            </div>

            <!-- Profit Analysis Section -->
            <div class="output-section">
                <p class="output-title">Profit Analysis</p>
                <p>Importer Profit per Case: $<span id="importer-profit-case">0</span></p>
                <p>Importer Total Profit: $<span id="importer-profit">0</span></p>
            </div>

            <button id="copy-link" class="copy-link-button">Copy Shareable Link</button>
        </div>
    </div>

    <script>
        function encodeInputDetails() {
            const type = document.getElementById("type").value;
            const cases = document.getElementById("cases").value;
            const cogs = document.getElementById("cogs").value;
            const shipping = document.getElementById("shipping").value;
            const warehousing = document.getElementById("warehousing").value;
            const transportation = document.getElementById("transportation").value;
            const misc = document.getElementById("misc").value;
            const stateTax = document.getElementById("state-tax").value;
            const inlandTransportation = document.getElementById("inland-transportation").value;
            const distributorWarehousing = document.getElementById("distributor-warehousing").value;
            const importerMargin = document.getElementById("importer-margin").value;
            const distributorMargin = document.getElementById("distributor-margin").value;
            const retailerMargin = document.getElementById("retailer-margin").value;

            const params = {
                type, cases, cogs, shipping, warehousing, transportation, misc,
                stateTax, inlandTransportation, distributorWarehousing,
                importerMargin, distributorMargin, retailerMargin
            };

            // Convert the params object into a query string
            const hash = Object.keys(params)
                .map(key => `${key}=${encodeURIComponent(params[key])}`)
                .join("&");

            // Update the URL
            history.replaceState(null, null, `#${hash}`);
        }

        function decodeInputDetails() {
            const hash = location.hash.substring(1); // Remove the '#' symbol
            const params = new URLSearchParams(hash);

            // Populate the fields
            if (params.has("type")) document.getElementById("type").value = params.get("type");
            if (params.has("cases")) document.getElementById("cases").value = params.get("cases");
            if (params.has("cogs")) document.getElementById("cogs").value = params.get("cogs");
            if (params.has("shipping")) document.getElementById("shipping").value = params.get("shipping");
            if (params.has("warehousing")) document.getElementById("warehousing").value = params.get("warehousing");
            if (params.has("transportation")) document.getElementById("transportation").value = params.get("transportation");
            if (params.has("misc")) document.getElementById("misc").value = params.get("misc");
            if (params.has("stateTax")) document.getElementById("state-tax").value = params.get("stateTax");
            if (params.has("inlandTransportation")) document.getElementById("inland-transportation").value = params.get("inlandTransportation");
            if (params.has("distributorWarehousing")) document.getElementById("distributor-warehousing").value = params.get("distributorWarehousing");
            if (params.has("importerMargin")) document.getElementById("importer-margin").value = params.get("importerMargin");
            if (params.has("distributorMargin")) document.getElementById("distributor-margin").value = params.get("distributorMargin");
            if (params.has("retailerMargin")) document.getElementById("retailer-margin").value = params.get("retailerMargin");

            syncSliders();

            // Trigger recalculation
            calculateResults();
        }


        const CBP_RATES = { whiskey: 2.06, vodka: 1.78, gin: 2.38, rum: 1.59 };

        function syncInput(sliderId, valueDisplayId) {
            const slider = document.getElementById(sliderId);
            const valueDisplay = document.getElementById(valueDisplayId);

            slider.addEventListener("input", () => {
                valueDisplay.textContent = sliderId.includes("margin") ? `${slider.value}%` : `$${slider.value}`;
                calculateResults();
            });
            valueDisplay.textContent = sliderId.includes("margin") ? `${slider.value}%` : `$${slider.value}`;
        }

        function syncSliders() {
            syncInput("cogs", "cogs-slider-value");
            syncInput("shipping", "shipping-slider-value");
            syncInput("warehousing", "warehousing-slider-value");
            syncInput("transportation", "transportation-slider-value");
            syncInput("inland-transportation", "inland-transportation-slider-value");
            syncInput("distributor-warehousing", "distributor-warehousing-slider-value");
            syncInput("importer-margin", "importer-margin-slider-value");
            syncInput("distributor-margin", "distributor-margin-slider-value");
            syncInput("retailer-margin", "retailer-margin-slider-value");
        }

        syncSliders();

        function calculateResults() {
            const type = document.getElementById("type").value;
            const cases = Number(document.getElementById("cases").value);
            const litersPerCase = 9; // Fixed at 9 liters per case
            const stateTax = Number(document.getElementById("state-tax").value);
            const inlandTransportation = Number(document.getElementById("inland-transportation").value);
            const warehousing = Number(document.getElementById("distributor-warehousing").value);
            const cogs = Number(document.getElementById("cogs").value);
            const shipping = Number(document.getElementById("shipping").value);
            const warehousingCost = Number(document.getElementById("warehousing").value);
            const transportation = Number(document.getElementById("transportation").value);
            const misc = Number(document.getElementById("misc").value);

            const importerMargin = Number(document.getElementById("importer-margin").value) / 100;
            const distributorMargin = Number(document.getElementById("distributor-margin").value) / 100;
            const retailerMargin = Number(document.getElementById("retailer-margin").value) / 100;

            const federalTaxPerCase = litersPerCase * 0.40; // Example federal tax
            const cbpDutyPerCase = litersPerCase * CBP_RATES[type]; // Using "whiskey" as default
            const baseCost = cogs + shipping + warehousingCost + transportation + (misc / cases) + federalTaxPerCase + cbpDutyPerCase;

            // Importer Selling Price
            const importerPrice = baseCost * (1 + importerMargin);

            // Distributor Costs
            const stateTaxPerCase = litersPerCase * stateTax;
            const distributorCosts = stateTaxPerCase + inlandTransportation + warehousing;

            console.log(stateTaxPerCase, inlandTransportation, warehousing);

            console.log(type);

            // Distributor Selling Price
            const distributorPrice = (importerPrice + distributorCosts) * (1 + distributorMargin);

            // Retailer Selling Price
            const retailerPrice = distributorPrice / (1 - retailerMargin);

            // Per-Bottle Pricing
            const importerPriceBottle = importerPrice / 12;
            const distributorPriceBottle = distributorPrice / 12;
            const retailPriceBottle = retailerPrice / 12;

            // Profits
            const importerProfitPerCase = importerPrice - baseCost;
            const importerTotalProfit = importerProfitPerCase * cases;

            // Update Output Results
            document.getElementById("excise-tax").textContent = federalTaxPerCase.toFixed(2);
            document.getElementById("cbp-duty").textContent = cbpDutyPerCase.toFixed(2);
            document.getElementById("total-cost").textContent = baseCost.toFixed(2);
            document.getElementById("importer-price").textContent = importerPrice.toFixed(2);
            document.getElementById("distributor-costs").textContent = distributorCosts.toFixed(2);
            document.getElementById("distributor-price").textContent = distributorPrice.toFixed(2);
            document.getElementById("retail-price").textContent = retailerPrice.toFixed(2);
            document.getElementById("importer-price-bottle").textContent = importerPriceBottle.toFixed(2);
            document.getElementById("distributor-price-bottle").textContent = distributorPriceBottle.toFixed(2);
            document.getElementById("retail-price-bottle").textContent = retailPriceBottle.toFixed(2);
            document.getElementById("importer-profit-case").textContent = importerProfitPerCase.toFixed(2);
            document.getElementById("importer-profit").textContent = importerTotalProfit.toFixed(2);
        }

        document.getElementById("type").addEventListener("change", calculateResults);
        document.getElementById("cases").addEventListener("input", calculateResults);
        document.getElementById("state-tax").addEventListener("change", calculateResults);
        document.getElementById("misc").addEventListener("input", calculateResults);

        calculateResults(); // Initial calculation

        document.getElementById("copy-link").addEventListener("click", () => {
            encodeInputDetails();
            const link = location.href;
            navigator.clipboard.writeText(link).then(() => {
                alert("Link copied to clipboard!");
            });
        });

        window.addEventListener("load", decodeInputDetails);
    </script>
</body>
</html>
